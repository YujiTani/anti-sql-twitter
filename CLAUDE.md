# CLAUDE.md

このファイルは、Claude Code (claude.ai/code) がこのリポジトリで作業する際のガイダンスを提供します。

**重要ルール**
- このプロジェクトでは必ず日本語で回答してください。
- 今回限りではなく、常に対応が必要だと思われる指示を受けた場合、以下の返答をしてください
    1. 「これを標準ルールにしますか？」と確認する
    2. 「YES」と返答があった場合、以下の内容を `CLAUDE.md` に追加する、追記場所はカテゴリーごとに分けて可読性が高い状態を保つ
        - その指示内容
        - その指示に対する説明
    3. 以降は標準ルールとして常に適用する

## Git管理ルール

### コミット頻度
- **タスクごとにコミット**: 機能単位や修正単位で細かくコミットを行う
- **作業の区切りでコミット**: 一つの作業が完了したら必ずコミットする
- **意味のある単位でまとめる**: 関連する変更は一つのコミットにまとめるが、異なる目的の変更は分ける

### コミットメッセージ形式
```
種別: 簡潔な説明

詳細説明（必要に応じて）

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

### 機密情報管理
- `.env.local`、`.env.*.local` ファイルは必ずGitignoreに含める
- 環境変数や秘密鍵は絶対にコミットしない
- 設定ファイルには例やダミー値のみ記載

## TypeScript開発ルール

### インポート拡張子ルール
- TypeScriptファイル（.ts）をインポートする際は、**拡張子を付けない**
- このプロジェクトではBunランタイムを使用してES modules問題を解決
- Node.js環境での問題は、ランタイム選択で対応

例：
```typescript
// ✅ 正しい
import { corsMiddleware } from './corsMiddleware'

// ❌ 間違い  
import { corsMiddleware } from './corsMiddleware.js'
```

### 理由
- TypeScriptの標準的な書き方を維持
- Bunランタイムが拡張子なしインポートをサポート
- ソースコードの一貫性と可読性を保つため
- ソースコードの一貫性と可読性を保つため


## プロジェクト構成

フロントエンド（React/Vite）とバックエンド（Hono）からなるフルスタックアプリケーションです：

- **フロントエンド**: `/frontend/` にある React + TypeScript + Vite アプリケーション
- **バックエンド**: `/backend/` にある Hono API サーバー
- **パッケージ管理**: すべてのパッケージ管理とスクリプト実行に Bun を使用
- **コード品質**: モノレポ全体の フォーマット・リント に Biome を使用

## 開発コマンド

### ルートレベル（モノレポ）
```bash
# プロジェクト全体のコードフォーマット
bun run format

# フォーマットチェック
bun run format:check  

# コードリント
bun run lint

# リント問題の自動修正
bun run lint:fix

# フォーマット・リント両方のチェックと修正
bun run check:fix
```

### フロントエンド開発
```bash
cd frontend

# 開発サーバー起動
bun run dev

# 本番用ビルド
bun run build

# 型チェック
bun run check-types

# 本番プレビュー起動
bun run start
```

### バックエンド開発
```bash
cd backend

# ホットリロード付き開発サーバー起動
bun run dev

# TypeScript ビルド
bun run build

# 本番サーバー起動
bun run start

# テスト実行
bun run test
```

## アーキテクチャ概要

### フロントエンドアーキテクチャ
- **状態管理**: Jotai（アトミック状態管理）、TanStack Query（サーバー状態管理）
- **認証**: `/features/auth/` にカスタムコンポーネントを持つ Supabase Auth
- **ルーティング**: `/components/layouts/` のレイアウトコンポーネントを使った React Router
- **UI コンポーネント**: Tailwind CSS スタイリングによる `/components/ui/` のカスタムコンポーネント
- **API 統合**: `/api/api-client.ts` の一元化された API クライアント

### バックエンドアーキテクチャ
- **フレームワーク**: ミドルウェアパターンによる Hono Web フレームワーク
- **ミドルウェア**: CORS、ログ、セキュリティヘッダーを含む `/middlewares/` に整理
- **アプリケーションファクトリー**: `app.ts` の `createApp()` 関数でアプリ設定を一元化

### 主要な統合機能
- **データベース**: Supabase（環境変数 VITE_SUPABASE_URL、VITE_SUPABASE_ANON_KEY で設定）
- **デプロイメント**: バックエンドは Dockerfile、フロントエンドは Render デプロイメント用に設定

## コード品質基準

- **Biome 設定**: 100文字行幅での厳格な TypeScript ルール
- **プリコミットフック**: 自動フォーマット・リント用の Husky + lint-staged
- **テスト**: フロントエンドは HappyDOM 付き Vitest、バックエンドは Bun test

## プロジェクト要件・仕様

このプロジェクトは「SQLパフォーマンスチューニング練習用のSNSアプリケーション」です。
開発前には必ず `app-development-interview.md` を参照して、プロジェクトの詳細要件を確認してください。

### 主要な特徴
- **仮想ユーザーによる自動SNS**：AIが生成する仮想ユーザーが自動でツイート・フォロー・リアクション
- **SQLパフォーマンス学習**：意図的に非効率なDB設計・クエリを組み込み、改善学習を目的とする
- **学習環境提供**：デモ版リリース後、開発者がfork/cloneして各自の環境で改善学習

### 技術仕様の重要なポイント
- **Prisma使用方針**：永続化処理とオブジェクトマッピングに使用、ただしクエリービルダーは使わずにSQLで記述
- **OpenAI API統合**：ツイート生成、フォロー判定、リツイート判定に使用
- **パフォーマンス悪化の意図的実装**：N+1問題、インデックス不足、正規化不足等のアンチパターンを含む
- **データ量設計**：ローカル環境で100万行程度のデータでパフォーマンス差を体感できるように設計

新機能の実装や設計判断時は、上記の学習目的とパフォーマンス教育の観点を考慮してください。
